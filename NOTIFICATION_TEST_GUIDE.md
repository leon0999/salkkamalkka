# 📬 알림 테스트 가이드

## ✅ 알림 시스템 개요

### 알림 발송 스케줄
- **D-3일 저녁 8시**: "고민할 시간이 3일 남았어요!"
- **D-2일 저녁 8시**: "고민할 시간이 2일 남았어요!"
- **D-1일 저녁 8시**: "고민할 시간이 1일 남았어요!"
- **D-Day 저녁 8시**: "고민할 시간이 끝났어요!"

### 최적의 알림 시간대 선택 이유
**저녁 8시 (20:00)**를 선택한 근거:
1. **퇴근 후 여유 시간**: 대부분의 직장인이 퇴근하여 개인 시간을 보낼 때
2. **구매 결정 최적 시간**: 온라인 쇼핑 트래픽이 가장 높은 시간대 (19:00-22:00)
3. **알림 확인률 높음**: 스마트폰 사용량이 많은 저녁 시간대
4. **충동구매 방지 효과**: 잠자기 전 다시 한번 생각할 시간 제공

---

## 🧪 알림 테스트 방법

### 방법 1: 짧은 대기 시간으로 즉시 테스트 (추천)

#### 1단계: 테스트용 코드 수정
`WishItem.swift`에서 대기 시간을 7일 → 1분으로 변경:

```swift
// 원본 코드 (7일)
self.waitingUntil = Calendar.current.date(byAdding: .day, value: waitingDays, to: createdAt) ?? createdAt

// 테스트용 코드 (1분 후)
self.waitingUntil = Calendar.current.date(byAdding: .minute, value: 1, to: createdAt) ?? createdAt
```

#### 2단계: 알림 시간 즉시 발송으로 변경
`NotificationManager.swift`에서 저녁 8시 → 즉시 발송:

```swift
// 원본 코드 (저녁 8시)
triggerDateComponents.hour = 20
triggerDateComponents.minute = 0

// 테스트용 코드 (10초 후)
let trigger = UNTimeIntervalNotificationTrigger(timeInterval: 10, repeats: false)
```

#### 3단계: 실제 테스트
1. **앱 실행** → Xcode에서 빌드 (Cmd + R)
2. **물건 등록** → "테스트 상품" 등록
3. **홈 버튼** → 앱을 백그라운드로 전환
4. **10초 대기** → 알림이 오는지 확인
5. **알림센터 확인** → 스와이프해서 알림 확인

✅ **성공**: 10초 후 알림 도착
❌ **실패**: 알림 권한 거부됨 → 설정 > 살까말까 > 알림 켜기

---

### 방법 2: Xcode Time Trigger로 시간 조작 (시뮬레이터 전용)

#### 1단계: Scheme 설정
1. Xcode > Product > Scheme > Edit Scheme
2. Run > Options > Time Trigger > 체크
3. Date & Time: 원하는 날짜/시간 설정 (예: 오늘 저녁 7시 55분)

#### 2단계: 앱 실행 및 등록
1. 시뮬레이터에서 앱 실행
2. 물건 등록 (D-Day가 오늘 밤 8시가 되도록 설정)
3. 앱 종료 (Cmd + Shift + H)

#### 3단계: 시간 진행
1. Xcode > Debug > Simulate Time: 저녁 8시 00분으로 변경
2. 알림 확인

⚠️ **주의**: 시뮬레이터는 로컬 알림만 지원하므로 제한적

---

### 방법 3: 실제 기기에서 장기 테스트 (실전 테스트)

#### 1단계: 실기기 연결
1. iPhone을 Mac에 USB 연결
2. Xcode > Product > Destination > 본인 기기 선택
3. Signing & Capabilities > Team 설정

#### 2단계: 앱 설치 및 물건 등록
1. Xcode에서 Cmd + R (실기기에 설치)
2. 물건 등록: "에어팟 프로" / 329,000원
3. 홈 버튼 → 앱 완전히 종료

#### 3단계: 대기 및 확인
- **D-3일 저녁 8시**: 첫 번째 알림 확인
- **D-2일 저녁 8시**: 두 번째 알림 확인
- **D-1일 저녁 8시**: 세 번째 알림 확인
- **D-Day 저녁 8시**: 네 번째 알림 확인

#### 확인 사항:
- ✅ 앱이 꺼져 있어도 알림이 오는가?
- ✅ 알림센터에 4개 알림이 쌓이는가?
- ✅ 알림을 탭하면 앱이 실행되는가?
- ✅ 배지(Badge) 숫자가 표시되는가?

---

## 🔍 알림 디버깅 방법

### 1. 알림 권한 확인
```swift
// WishListViewModel.swift - init()에서 확인
NotificationManager.shared.requestAuthorization { granted in
    print(granted ? "✅ 알림 권한 허용됨" : "❌ 알림 권한 거부됨")
}
```

### 2. 예약된 알림 확인
Xcode 콘솔에서 확인:
```
✅ 알림 스케줄링 성공 (D-3, 20:00): 에어팟 프로
✅ 알림 스케줄링 성공 (D-2, 20:00): 에어팟 프로
✅ 알림 스케줄링 성공 (D-1, 20:00): 에어팟 프로
✅ 알림 스케줄링 성공 (D0, 20:00): 에어팟 프로
```

### 3. 대기 중인 알림 개수 확인
```swift
// NotificationManager.swift
NotificationManager.shared.checkPendingNotifications()
// 출력: 📬 대기 중인 알림: 4개
```

### 4. iOS 설정에서 확인
- 설정 > 살까말까 > 알림
- 알림 허용 ✅
- 소리 ✅
- 배지 ✅
- 잠금 화면 ✅

---

## 🚨 자주 발생하는 문제

### Q1. 알림이 안 와요
**해결 방법:**
1. 설정 > 살까말까 > 알림 켜져 있는지 확인
2. iPhone 방해금지 모드 해제
3. 알림 권한 재요청 (앱 삭제 후 재설치)

### Q2. 앱이 꺼져 있으면 알림이 안 와요
**정상입니다!** iOS의 로컬 알림은:
- ✅ 앱이 백그라운드에 있어도 작동
- ✅ 앱이 완전히 종료되어도 작동
- ✅ iPhone을 재부팅해도 작동

### Q3. 시뮬레이터에서 알림이 안 와요
**시뮬레이터의 제한사항:**
- ⚠️ 로컬 알림만 부분 지원
- ⚠️ 배지(Badge) 미지원
- ✅ **실제 기기에서만 100% 테스트 가능**

### Q4. D-3부터 매일 알림이 와야 하는데 한 번만 와요
**알림 스케줄링 확인:**
```swift
// 4개 알림이 모두 예약되었는지 확인
NotificationManager.shared.checkPendingNotifications()
```

---

## 📊 최종 체크리스트

### 개발 환경 테스트
- [ ] 알림 권한 허용 확인
- [ ] 물건 등록 시 콘솔에 4개 알림 스케줄링 성공 로그 확인
- [ ] 1분 후 알림 오도록 설정 변경 후 즉시 테스트
- [ ] 앱 백그라운드에서 알림 도착 확인

### 실기기 테스트
- [ ] iPhone에 앱 설치
- [ ] 물건 등록 후 앱 완전 종료
- [ ] D-3일 저녁 8시 알림 확인
- [ ] D-2일 저녁 8시 알림 확인
- [ ] D-1일 저녁 8시 알림 확인
- [ ] D-Day 저녁 8시 알림 확인
- [ ] 알림센터에 4개 알림 쌓임 확인

### 사용자 경험 테스트
- [ ] 알림 탭하면 DecisionView 표시 (현재 구현 안 됨 → 추후 개선)
- [ ] 알림 문구가 명확한가?
- [ ] 저녁 8시가 적절한 시간인가?

---

## ✅ 권장 테스트 순서

1. **5분 즉시 테스트** (개발 단계)
   - 코드 수정: 7일 → 1분, 저녁 8시 → 10초 후
   - 앱 실행 → 물건 등록 → 10초 대기
   - ✅ 알림 도착 확인

2. **실기기 1주일 테스트** (배포 전)
   - 원본 코드로 복원
   - 실제 iPhone에 설치
   - 7일 동안 매일 저녁 8시 알림 확인

3. **베타 테스터 피드백** (TestFlight)
   - 30명에게 배포
   - 알림 도착률 통계 수집
   - 최적 시간대 A/B 테스트 (저녁 8시 vs 저녁 9시)

---

**Made with ❤️ by Claude**
